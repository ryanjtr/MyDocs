<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PULP Toolchain and SDK &mdash; RyanDocs 2024 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="GVSOC" href="GVSOC.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> RyanDocs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Professional_terminology.html">Professional terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../github.html">Github</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sphinx.html">Sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zephyr.html">Zephyr</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pcb.html">Board PCB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mqtt.html">MQTT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../internet.html">Internet</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="riscv.html">RISC-V</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Introduction.html">Assembly Language</a></li>
<li class="toctree-l2"><a class="reference internal" href="Code.html">Examples and Explanations</a></li>
<li class="toctree-l2"><a class="reference internal" href="Assembly_script.html">The RV32I ISA</a></li>
<li class="toctree-l2"><a class="reference internal" href="GVSOC.html">GVSOC</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">PULP Toolchain and SDK</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pulp-toolchain-installation">PULP Toolchain installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pulp-sdk-installation">PULP SDK installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#first-simple-test">First simple test</a></li>
<li class="toctree-l3"><a class="reference internal" href="#references">References</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-code-in-pulp-sdk">Run code in pulp-sdk</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lab">Lab</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#task-1">Task 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#task-2">Task 2</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">RyanDocs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="riscv.html">RISC-V</a> &raquo;</li>
      <li>PULP Toolchain and SDK</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/Contents/RISCV/Pulp_toolchain_and_sdk.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pulp-toolchain-and-sdk">
<h1>PULP Toolchain and SDK<a class="headerlink" href="#pulp-toolchain-and-sdk" title="Permalink to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>PULP (Parallel Ultra-Low Power) Platform is a holistic initiative aimed at developing energy-efficient
parallel computing solutions. It encompasses various hardware and software components tailored for
embedded and IoT applications, along with a vibrant community promoting collaboration and innovation.
The hardware components include PULP cores and systems designed for minimal power consumption and
optimized performance. On the software side, the platform supports operating systems, compilers,
development tools, libraries, middleware, and frameworks to streamline application development.
The open-source nature of PULP encourages innovation and knowledge-sharing, while educational
resources empower developers to harness parallel computing for energy-efficient solutions.
Overall, the PULP Platform provides a comprehensive ecosystem to foster the advancement of
energy-efficient computing in diverse embedded and IoT domains.</p>
</section>
<section id="pulp-toolchain-installation">
<h2>PULP Toolchain installation<a class="headerlink" href="#pulp-toolchain-installation" title="Permalink to this heading"></a></h2>
<p>Open new terminal to create new directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span>
<span class="nb">cd</span> /opt
sudo mkdir riscv
<span class="nb">cd</span> riscv
sudo mkdir bin
</pre></div>
</div>
<p>Setup path:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nano ~/.profile
</pre></div>
</div>
<p>Add</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> -d <span class="s2">&quot;/opt/riscv&quot;</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
    <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/opt/riscv:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
<span class="k">fi</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Log out Ubuntu and then log in after edit <code class="docutils literal notranslate"><span class="pre">.profile</span></code></p>
</div>
<p>Prerequisite</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-get install autoconf automake autotools-dev curl libmpc-dev libmpfr-dev libgmp-dev gawk build-essential bison flex texinfo gperf libtool patchutils bc zlib1g-dev
</pre></div>
</div>
<p>Follow these steps to install toolchain:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/pulp-platform/pulp-riscv-gnu-toolchain
<span class="nb">cd</span> pulp-riscv-gnu-toolchain
git submodule update --init --recursive
</pre></div>
</div>
<p>Cause <code class="docutils literal notranslate"><span class="pre">/opt/riscv/bin</span></code> is in <code class="docutils literal notranslate"><span class="pre">root</span></code>, so must use <code class="docutils literal notranslate"><span class="pre">sudo</span></code> in <code class="docutils literal notranslate"><span class="pre">make</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./configure --prefix<span class="o">=</span>/opt/riscv --with-arch<span class="o">=</span>rv32imc --with-cmodel<span class="o">=</span>medlow --enable-multilib
sudo make
</pre></div>
</div>
</section>
<section id="pulp-sdk-installation">
<h2>PULP SDK installation<a class="headerlink" href="#pulp-sdk-installation" title="Permalink to this heading"></a></h2>
<p>Prerequisite</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-get install -y build-essential git libftdi-dev libftdi1 doxygen python3-pip libsdl2-dev curl cmake libusb-1.0-0-dev scons gtkwave libsndfile1-dev rsync autoconf automake texinfo libtool pkg-config libsdl2-ttf-dev
</pre></div>
</div>
<p>Follow these steps:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install argcomplete pyelftools six
pip install prettytable
</pre></div>
</div>
<p>Clone pulp SDK and update submodule:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/pulp-platform/pulp-sdk.git
<span class="nb">cd</span> pulp-sdk
git submodule update --init --recursive
</pre></div>
</div>
<p>Edit <code class="docutils literal notranslate"><span class="pre">pulp-sdk/configs/pulp-open.sh</span></code>, below line 32:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PULP_RISCV_GCC_TOOLCHAIN</span><span class="o">=</span>/opt/riscv
</pre></div>
</div>
<p>Build gvsoc</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> configs/pulp-open.sh
make build
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Always run command <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">configs/pulp-open.sh</span></code> before running or doing anything in <code class="docutils literal notranslate"><span class="pre">pulp-sdk</span></code> directory</p>
</div>
</section>
<section id="first-simple-test">
<h2>First simple test<a class="headerlink" href="#first-simple-test" title="Permalink to this heading"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> pulp-sdk
<span class="nb">source</span> configs/pulp-open.sh
<span class="nb">cd</span> tests/hello

make clean all run
</pre></div>
</div>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading"></a></h2>
<p><a class="reference external" href="https://www.pulp-platform.org/docs/pulp_training/NBruschi_gvsoc_tutorial_part1.pdf" rel="noopener noreferrer" target="_blank">[1]. Installation toolchain and sdk</a></p>
</section>
<section id="run-code-in-pulp-sdk">
<h2>Run code in pulp-sdk<a class="headerlink" href="#run-code-in-pulp-sdk" title="Permalink to this heading"></a></h2>
<p>Copy project folder to path <code class="docutils literal notranslate"><span class="pre">pulp-sdk/tests/</span></code> and then run.</p>
</section>
<section id="lab">
<h2>Lab<a class="headerlink" href="#lab" title="Permalink to this heading"></a></h2>
<p><a class="reference external" href="https://github.com/EEESlab/APAI23-LAB03-PULP-Embedded-Programming/blob/f862501580a95426f8a420779cf88869e134b596/docs/slides.pdf" rel="noopener noreferrer" target="_blank">LAB03 Embedded Programming on PULP</a></p>
<section id="task-1">
<h3>Task 1<a class="headerlink" href="#task-1" title="Permalink to this heading"></a></h3>
<p>If we change define N with 350. The checksum and the result will not be correct due to the limited range of data type <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span></code>, just 0-255.
So we must change the data type of array to <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span></code> to have better range.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="cm">/*</span>
<span class="cm">* Copyright (C) 2021 University of Bologna</span>
<span class="cm">* All rights reserved.</span>
<span class="cm">*</span>
<span class="cm">* This software may be modified and distributed under the terms</span>
<span class="cm">* of the BSD license.  See the LICENSE file for details.</span>
<span class="cm">*</span>
<span class="cm">* Authors: Manuele Rusci      UniBO (manuele.rusci@unibo.it)</span>
<span class="cm">*                   Lorenzo Lamberti  UniBO (lorenzo.lamberti@unibo.it)</span>
<span class="cm">*/</span><span class="w"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;pmsis.h&quot;</span><span class="cp"></span>

<span class="cp">#define N 350                        </span><span class="c1">// array size</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">array_1</span><span class="p">[</span><span class="n">N</span><span class="p">];</span><span class="w"> </span><span class="c1">// define array of size N.         [important note]: &quot;char&quot; data type means its elements are 8 bit! (range from 0 to 255)</span>

<span class="c1">// intialize an array A_ar with _size_ number of elements</span>
<span class="c1">// and precompute the result (we use this as a checksum)</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">init_array</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">A_ar</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">A_ar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// this can be changed to whatever pattern</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// this computes the sum as the vector_sum() function. only needed as a checksum.</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// print array elements</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">print_array</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">A_ar</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">A_ar</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"> </span><span class="c1">// print array element</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// return the index of the item==element of the array A_ar with size number of elements</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">vector_sum</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">A_ar</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// initialize accumulator to 0</span>

<span class="w">    </span><span class="c1">// perform the sum</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">A_ar</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">sum</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;This example program computes the sum of %d integer numbers!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// initialize the array and get the expected result</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">expected_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_array</span><span class="p">(</span><span class="n">array_1</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// inspect the array. let&#39;s print its values !</span>
<span class="w">    </span><span class="n">print_array</span><span class="p">(</span><span class="n">array_1</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// call the vector_sum function</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">computed_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vector_sum</span><span class="p">(</span><span class="n">array_1</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// check if the results is correct</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">computed_result</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">expected_result</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Result is correct. Got %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">computed_result</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">else</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Result is not correct. Got %d instead of %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">computed_result</span><span class="p">,</span><span class="w"> </span><span class="n">expected_result</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="task-2">
<h3>Task 2<a class="headerlink" href="#task-2" title="Permalink to this heading"></a></h3>
<p>Code in task 2 performs maxtrix-vector multiplication and measures its performance using performance counter
on the PULP platform.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="cm">/*</span>
<span class="cm">* Copyright (C) 2022 University of Bologna</span>
<span class="cm">* All rights reserved.</span>
<span class="cm">*</span>
<span class="cm">* This software may be modified and distributed under the terms</span>
<span class="cm">* of the BSD license.  See the LICENSE file for details.</span>
<span class="cm">*</span>
<span class="cm">* Authors: Manuele Rusci      UniBO (manuele.rusci@unibo.it)</span>
<span class="cm">*                   Lorenzo Lamberti  UniBO (lorenzo.lamberti@unibo.it)</span>
<span class="cm">*/</span><span class="w"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;pmsis.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;stdbool.h&quot;</span><span class="c1"> // to use &quot;bool&quot; data type</span><span class="cp"></span>

<span class="cm">/*  defines */</span><span class="w"></span>
<span class="cp">#define N 50 </span><span class="c1">// the matrix size is NxM, and the vector size is M.</span>
<span class="cp">#define M 50</span>
<span class="cp">#define MAT_EL (2) </span><span class="c1">// matrix constant values</span>
<span class="cp">#define VEC_EL (4) </span><span class="c1">// vector constant values</span>
<span class="kt">int</span><span class="w"> </span><span class="n">mac_counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="cm">/* Allocation of IO variables into L2 memory */</span><span class="w"></span>
<span class="c1">// input variables</span>
<span class="n">PI_L2</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">matrix</span><span class="p">[</span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M</span><span class="p">];</span><span class="w"> </span><span class="c1">// the matrix as an array of size N*M</span>
<span class="n">PI_L2</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">vector</span><span class="p">[</span><span class="n">M</span><span class="p">];</span><span class="w">         </span><span class="c1">// the vector as an array of size M</span>
<span class="c1">// output variable</span>
<span class="n">PI_L2</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">output_vec</span><span class="p">[</span><span class="n">N</span><span class="p">];</span><span class="w"> </span><span class="c1">// N*M x M*1 -&gt; N*1</span>
<span class="cm">/*  Note: PI_L2 is an attribute for &quot;forcing&quot; allocation in L2 memory.</span>
<span class="cm">    Ref: /pulp/pulp-sdk/rtos/pulpos/common/include/pos/data/data.h:54: */</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">start_perf_counter</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// enable the perf counter of interest</span>
<span class="w">    </span><span class="n">pi_perf_conf</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">PI_PERF_CYCLES</span><span class="w"> </span><span class="cm">/*YOUR_CODE_HERE*/</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="c1">// count cycles</span>
<span class="w">                </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">PI_PERF_INSTR</span><span class="w"> </span><span class="cm">/*YOUR_CODE_HERE*/</span><span class="p">);</span><span class="w">  </span><span class="c1">// count instructions</span>
<span class="w">    </span><span class="c1">// reset the perf counters</span>
<span class="w">    </span><span class="n">pi_perf_reset</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="c1">//  start the perf counter</span>
<span class="w">    </span><span class="n">pi_perf_start</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">stop_perf_counter</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// stop the perf counter</span>
<span class="w">    </span><span class="n">pi_perf_stop</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="c1">// collect and print statistics</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">cycles_counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pi_perf_read</span><span class="p">(</span><span class="n">PI_PERF_CYCLES</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">instr_counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pi_perf_read</span><span class="p">(</span><span class="n">PI_PERF_INSTR</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="cm">/*</span>
<span class="cm">        TASK 2.2</span>
<span class="cm">        Measure:</span>
<span class="cm">            - How many MAC operations are needed for the gemv</span>
<span class="cm">        Calculate:</span>
<span class="cm">            - CPI</span>
<span class="cm">            - MACs/Cycles</span>
<span class="cm">            - Instructions/Cycles</span>
<span class="cm">            - Instructions/ MACs</span>
<span class="cm">    */</span><span class="w"></span>

<span class="w">    </span><span class="c1">// N° Multiply Accumulate Operations (MACs)</span>
<span class="w">    </span><span class="cm">/* already done with task 2.1. use the mac_counter global variable */</span><span class="w"></span>
<span class="w">    </span><span class="c1">// CPI = cycles / n°instructions_executed</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">cpi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cycles_counter</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">instr_counter</span><span class="p">;</span><span class="w"> </span><span class="cm">/* YOUR CODE HERE*/</span><span class="w"></span>
<span class="w">    </span><span class="c1">// MAC/Cycles</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">mac_on_cycles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">cycles_counter</span><span class="p">;</span><span class="w"> </span><span class="cm">/* YOUR CODE HERE*/</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Instructions/Cycles</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">instructions_on_cycles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instr_counter</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">cycles_counter</span><span class="p">;</span><span class="w"> </span><span class="cm">/* YOUR CODE HERE*/</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Instructions/MAC</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">instructions_on_mac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instr_counter</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M</span><span class="p">);</span><span class="w"> </span><span class="cm">/* YOUR CODE HERE*/</span><span class="w"></span>

<span class="w">    </span><span class="c1">// print results</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;--- Performances ---------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Cycles: %d </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cycles_counter</span><span class="p">);</span><span class="w">                                          </span><span class="c1">// this comes from the performance counter</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;N° of Intructions: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">instr_counter</span><span class="p">);</span><span class="w">                         </span><span class="c1">// this comes from the performance counter</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;mac: %d </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mac_counter</span><span class="p">);</span><span class="w">                                                        </span><span class="c1">// you must measure this</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;CPI: %f </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cpi</span><span class="p">);</span><span class="w">                                                                        </span><span class="c1">// calculate it</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Instructions/Cycles: %f </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">instructions_on_cycles</span><span class="p">);</span><span class="w"> </span><span class="c1">// calculate it</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Instructions/MAC: %f </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">instructions_on_mac</span><span class="p">);</span><span class="w">           </span><span class="c1">// calculate it</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;-------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// print array elements</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">print_array</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">A_ar</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">A_ar</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"> </span><span class="c1">// print array element</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="cm">/* generic matrix-vector multiplication */</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="w"> </span><span class="n">gemv</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">size_N</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size_M</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">mat_i</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">vec_i</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">vec_o</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    TASK 2.1</span>
<span class="cm">    - you must count the MAC by increasing a counter in the inner loop of the gemv.</span>
<span class="cm">    - use the &quot;mac_counter&quot; global variable</span>
<span class="cm">    */</span><span class="w"></span>
<span class="w">    </span><span class="n">mac_counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size_N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="c1">// outer looop of the gemv</span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size_M</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="c1">// inner loop of the gemv</span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// multiply accumulate operation (MAC)</span>
<span class="w">            </span><span class="n">vec_o</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">mat_i</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size_M</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vec_i</span><span class="p">[</span><span class="n">j</span><span class="p">];</span><span class="w"></span>
<span class="w">            </span><span class="c1">// *(vec_o + i) += *(mat_i + i * M + j) * (*(vec_i + j)); // try to uncomment this and comment the above line. You will notice a speedup in cycles</span>
<span class="w">            </span><span class="o">++</span><span class="n">mac_counter</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">start_perf_counter</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Initialization of operands: matrix</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M</span><span class="p">);</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">matrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MAT_EL</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Initialization of operands: vector</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">vector</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VEC_EL</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Initialization of the output to 0</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">output_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="cm">/* call the GEneric Matrix-Vector (gemv) function */</span><span class="w"></span>
<span class="w">    </span><span class="n">gemv</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="n">matrix</span><span class="p">,</span><span class="w"> </span><span class="n">vector</span><span class="p">,</span><span class="w"> </span><span class="n">output_vec</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// print and check the results</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The %d output elements are: </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">print_array</span><span class="p">(</span><span class="n">output_vec</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// check here the results</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">correctness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">output_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="p">(</span><span class="n">M</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MAT_EL</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">VEC_EL</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">correctness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="n">correctness</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">RESULTS MATCHING: correct</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;RESULTS NOT MATCHING: not correct</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">stop_perf_counter</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<table class="colwidths-given docutils align-default" id="id1">
<caption><span class="caption-text">Performance</span><a class="headerlink" href="#id1" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>-01</p></th>
<th class="head"><p>-03</p></th>
<th class="head"><p>-03 HWLoops</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Clock Cycles</p></td>
<td><p>198615</p></td>
<td><p>186262</p></td>
<td><p>190599</p></td>
</tr>
<tr class="row-odd"><td><p>Instr</p></td>
<td><p>71427</p></td>
<td><p>60329</p></td>
<td><p>62622</p></td>
</tr>
<tr class="row-even"><td><p>MAC</p></td>
<td><p>2500</p></td>
<td><p>2500</p></td>
<td><p>2500</p></td>
</tr>
<tr class="row-odd"><td><p>CPI</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>Intr/Cycles</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>Intr/MAC</p></td>
<td><p>28</p></td>
<td><p>24</p></td>
<td><p>25</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="GVSOC.html" class="btn btn-neutral float-left" title="GVSOC" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, RyanDank.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>